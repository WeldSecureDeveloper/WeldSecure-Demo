<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WeldSecure Outlook Add-in Reference</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light dark;
        --surface: #0f172a;
        --surface-alt: rgba(255, 255, 255, 0.06);
        --surface-card: rgba(15, 23, 42, 0.65);
        --border: rgba(255, 255, 255, 0.15);
        --text: #f8fafc;
        --text-muted: rgba(248, 250, 252, 0.75);
        --accent: #5ef1c5;
        --accent-soft: rgba(94, 241, 197, 0.12);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Rubik", "Segoe UI", system-ui, -apple-system, sans-serif;
        background: radial-gradient(circle at top right, #1e1b4b, #020617 60%);
        color: var(--text);
        padding: 3.5rem clamp(1.5rem, 3vw, 4rem) 4rem;
        line-height: 1.6;
      }

      header.hero {
        max-width: 960px;
        margin: 0 auto 2.5rem auto;
        text-align: left;
      }

      .hero .eyebrow {
        text-transform: uppercase;
        letter-spacing: 0.25em;
        font-size: 0.75rem;
        color: var(--text-muted);
        margin: 0 0 0.5rem 0;
      }

      .hero h1 {
        font-size: clamp(2.2rem, 6vw, 3.5rem);
        margin: 0 0 1rem 0;
      }

      .hero .lede {
        max-width: 720px;
        font-size: 1.1rem;
        margin-bottom: 1rem;
        color: var(--text-muted);
      }

      .tag-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .tag {
        padding: 0.4rem 0.85rem;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 0.85rem;
      }

      main {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      section.panel {
        background: var(--surface-card);
        border: 1px solid var(--border);
        border-radius: 1.5rem;
        padding: clamp(1.5rem, 3vw, 2.75rem);
        box-shadow: 0 25px 65px rgba(2, 6, 23, 0.55);
      }

      section.panel h2 {
        margin-top: 0;
        font-size: 1.5rem;
      }

      section.panel p {
        color: var(--text-muted);
        margin-top: 0.15rem;
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
        margin-top: 1.25rem;
      }

      .card {
        background: var(--surface-alt);
        border-radius: 1rem;
        padding: 1.25rem;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .card h3 {
        margin-top: 0;
        margin-bottom: 0.5rem;
        font-size: 1.05rem;
      }

      .card ul {
        margin: 0;
        padding-left: 1.1rem;
        color: var(--text-muted);
      }

      .split {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 2rem;
        margin-top: 1.25rem;
      }

      .callout {
        border: 1px dashed var(--border);
        border-radius: 1rem;
        padding: 1.25rem;
        background: rgba(255, 255, 255, 0.03);
      }

      ol,
      ul {
        padding-left: 1.25rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1.25rem;
        font-size: 0.95rem;
      }

      th,
      td {
        text-align: left;
        padding: 0.65rem 0.75rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.12);
        vertical-align: top;
      }

      th {
        font-weight: 600;
      }

      code {
        background: rgba(15, 23, 42, 0.7);
        padding: 0.15rem 0.35rem;
        border-radius: 0.35rem;
        font-size: 0.9em;
      }

      .checklist {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
        margin-top: 1.25rem;
      }

      .checklist article {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 1rem;
      }

      .checklist h3 {
        margin-top: 0;
      }

      footer {
        margin-top: 1rem;
        font-size: 0.85rem;
        color: var(--text-muted);
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header class="hero">
      <p class="eyebrow">WeldSecure Reporter</p>
      <h1>Outlook Add-in + Sandbox Reference</h1>
      <p class="lede">
        Use this page to understand how the Outlook-style shell, the Reporter add-in, and the sandbox
        share data, trigger points, and keep the celebration loop consistent across the static demo.
      </p>
      <div class="tag-list">
        <span class="tag">#addin route</span>
        <span class="tag">reporterSandbox.js</span>
        <span class="tag">state.meta.addin*</span>
        <span class="tag">WeldServices.recordSandboxSubmission</span>
      </div>
    </header>

    <main>
      <section class="panel">
        <h2>Experience Pillars</h2>
        <p>Four coordinated pieces deliver the Outlook narrative.</p>
        <div class="card-grid">
          <article class="card">
            <h3>Docked Outlook shell</h3>
            <ul>
              <li>
                <code>Static/features/reporterSandbox.js</code> renders the mock Outlook chrome (app
                bar, folders, focused/other tabs, reading pane).
              </li>
              <li>
                Message metadata comes from <code>AppData.phishingSimulations.sandboxMessages</code>,
                hydrated through <code>stateServices.ensureReporterSandboxState</code>.
              </li>
              <li>
                Selecting "Report" docks the add-in beside the reading pane and injects message
                signal IDs as context.
              </li>
            </ul>
          </article>
          <article class="card">
            <h3>Reporter add-in</h3>
            <ul>
              <li>
                <code>Static/features/reporter.js</code> exposes <code>render</code> for the
                <code>#addin</code> route and for in-sandbox mounting.
              </li>
              <li>
                Two screens: <em>report</em> (reason checklist, emergency toggle, notes) and
                <em>success</em> (ticker, badge burst, CTA to customer rewards).
              </li>
              <li>
                Guided tour keys (<code>reporter:addin:report</code>,
                <code>reporter:addin:success</code>) keep walkthrough bubbles scoped per screen.
              </li>
            </ul>
          </article>
          <article class="card">
            <h3>Recognition logic</h3>
            <ul>
              <li>
                <code>reportMessage()</code> in <code>Static/app.js</code> awards points, selects
                badges, and flips <code>state.meta.addinScreen</code> to "success".
              </li>
              <li>
                <code>state.meta.addinShellHeight</code> persists measured height so the iframe-like
                shell stays steady between reloads.
              </li>
              <li>
                <code>revertLastReportAward()</code> lets the success screen undo the last message as
                part of the demo loop.
              </li>
            </ul>
          </article>
          <article class="card">
            <h3>Sandbox + designer hand-off</h3>
            <ul>
              <li>
                The phishing designer writes <code>signalIds</code> onto sandbox messages, which
                power inline hints and the grading logic after submission.
              </li>
              <li>
                <code>WeldServices.updateSandboxFindings</code> caches checkbox picks live so a
                reload keeps selections.
              </li>
              <li>
                <code>WeldServices.recordSandboxSubmission</code> stores accuracy, feedback chips,
                and badge contexts for future reporting.
              </li>
            </ul>
          </article>
        </div>
      </section>

      <section class="panel">
        <h2>Outlook Shell Anatomy</h2>
        <p>Reference this stack when tweaking layout or hunting regressions.</p>
        <div class="split">
          <div>
            <ol>
              <li>
                <strong>App bar</strong> - <code>renderAppBar()</code> fakes waffle, logo, search,
                and avatar. Keep icons as emoji for zero-dependency rendering.
              </li>
              <li>
                <strong>Folder column</strong> - <code>renderFolders()</code> seeds buttons and badge
                counts. Button states drive the highlight ring and keep consistent spacing tokens.
              </li>
              <li>
                <strong>Focused/Other tabs</strong> - <code>renderTabs()</code> plus
                <code>data-sandbox-tab</code> event delegation (see
                <code>attach()</code> near line 190). State lives on
                <code>state.reporterSandbox.activeTab</code>.
              </li>
              <li>
                <strong>Message list</strong> - rows display sender, subject, preview, and a trailing
                status glyph tied to <code>sandbox.submissions</code>.
              </li>
              <li>
                <strong>Reading pane + add-in dock</strong> - the pane reuses signal chips, while
                <code>mountReporterDock()</code> injects the add-in markup in
                <code>.outlook-reporter__addin</code>.
              </li>
            </ol>
          </div>
          <div class="callout">
            <h3>Docking call stack</h3>
            <ol>
              <li>
                Reporter hits <strong>Report</strong> in the reading pane ->
                <code>mountReporterDock()</code>.
              </li>
              <li>
                Add-in renders with <code>options.sandboxContext</code> so
                <code>features/reporter.js</code> knows the active sandbox message.
              </li>
              <li>
                Submit button calls <code>reportMessage({ origin: "addin" })</code> plus
                <code>WeldServices.recordSandboxSubmission()</code> for scoring.
              </li>
              <li>
                <code>reportMessage</code> sets <code>state.meta.addinScreen = "success"</code>,
                re-renders, and the success screen offers "Back" (undo) + "View rewards".
              </li>
            </ol>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>State + Service Contracts</h2>
        <p>Key files involved in the Outlook story.</p>
        <table>
          <thead>
            <tr>
              <th>Concern</th>
              <th>Location</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Add-in route</td>
              <td><code>Static/registry.js:172-186</code></td>
              <td>
                Registers <code>#addin</code> to <code>features.reporter</code> with a single-column
                layout. Any navigation chip can deep link via <code>#addin</code>.
              </td>
            </tr>
            <tr>
              <td>Persisted meta</td>
              <td><code>Static/state.js:640-690</code></td>
              <td>
                <code>state.meta.addinScreen</code> defaults to "report", while
                <code>state.meta.addinShellHeight</code> keeps the measured dock height.
              </td>
            </tr>
            <tr>
              <td>Reporter UI</td>
              <td><code>Static/features/reporter.js</code></td>
              <td>
                <code>attachAddInEvents()</code> handles validation, dialog prompts, reward CTA, and
                guided tour sync. Uses <code>WeldUtil.generateId</code> for faux message IDs.
              </td>
            </tr>
            <tr>
              <td>Sandbox state</td>
              <td><code>Static/services/stateServices.js:334-390</code></td>
              <td>
                <code>ensureReporterSandboxState()</code> clones sandbox messages, sets active rows,
                keeps submissions capped at 24, and stores hint toggles.
              </td>
            </tr>
            <tr>
              <td>Findings + grading</td>
              <td><code>Static/services/stateServices.js:1229-1290</code></td>
              <td>
                <code>updateSandboxFindings</code> stores checkbox selections. After submit,
                <code>recordSandboxSubmission</code> compares signal IDs, records correctness, and
                resets hints.
              </td>
            </tr>
            <tr>
              <td>Points + celebration</td>
              <td><code>Static/app.js:1924-2127</code></td>
              <td>
                <code>reportMessage</code> increments points, queues badge unlock animations, tracks
                last award metadata, and exposes <code>revertLastReportAward</code>.
              </td>
            </tr>
          </tbody>
        </table>
      </section>

      <section class="panel">
        <h2>Sandbox Submission Loop</h2>
        <p>Use this sequence to trace bugs end-to-end.</p>
        <ol>
          <li>
            Reporter selects a sandbox email -
            <code>WeldServices.setActiveSandboxMessage(id)</code> (called inside the sandbox feature)
            stores the row and scrolls the message preview into view.
          </li>
          <li>
            Reporter checks red flag boxes -
            <code>WeldServices.updateSandboxFindings</code> persists live selections keyed by
            <code>messageId</code>.
          </li>
          <li>
            Reporter hits "Report" -
            <code>features.reporter.render</code> mounts with <code>sandboxContext</code>.
          </li>
          <li>
            Submit fires -
            <code>reportMessage({ origin: "addin" })</code> adds a message to <code>state.messages</code>,
            awards points, and sets the success screen.
          </li>
          <li>
            Sandbox entry gets graded -
            <code>WeldServices.recordSandboxSubmission</code> compares selections to
            <code>message.signalIds</code>, marks success/fail, hides hints, and re-renders the inbox
            chips.
          </li>
          <li>
            Reporter can replay celebration or switch back -
            <code>revertLastReportAward()</code> plus <code>setRole("customer")</code> keep the demo
            loop continuous.
          </li>
        </ol>
      </section>

      <section class="panel">
        <h2>Debug Checklist</h2>
        <p>Most Outlook issues fall into these buckets.</p>
        <div class="checklist">
          <article>
            <h3>Add-in never mounts</h3>
            <ul>
              <li>Ensure <code>features.reporter</code> is loaded before <code>reporterSandbox.js</code>.</li>
              <li>
                Confirm <code>mountReporterDock</code> receives a message with a valid
                <code>id</code> (log <code>sandbox.activeMessageId</code>).
              </li>
              <li>
                If route <code>#addin</code> is blank, verify <code>window.Weld</code> initialized
                (missing script order in <code>Static/index.html</code> will block render).
              </li>
            </ul>
          </article>
          <article>
            <h3>Stuck on success screen</h3>
            <ul>
              <li>
                Check <code>state.meta.addinScreen</code> in DevTools. If it is "success", use
                <code>revertLastReportAward()</code> or "Reset demo data".
              </li>
              <li>
                Confirm no uncaught errors inside <code>setupCelebrationReplay</code> (bad DOM query
                can short-circuit <code>attachAddInEvents</code>).
              </li>
            </ul>
          </article>
          <article>
            <h3>Signals don't grade</h3>
            <ul>
              <li>
                Validate each sandbox message carries <code>signalIds</code> (set in the phishing
                designer seeding logic).
              </li>
              <li>
                Ensure <code>recordSandboxSubmission</code> receives <code>messageId</code>; the dock
                passes it through <code>sandboxContext</code>.
              </li>
              <li>
                Verify <code>state.reporterSandbox.submissions</code> is not mutated elsewhere; the
                feature expects an array of objects with <code>success</code>/<code>missedSignals</code>.
              </li>
            </ul>
          </article>
          <article>
            <h3>Shell height jumps</h3>
            <ul>
              <li>
                <code>applyAddInShellSizing()</code> measures <code>.addin-shell</code>; mismatched
                CSS selectors can prevent <code>--addin-shell-height</code> from updating.
              </li>
              <li>
                Ensure <code>state.meta.addinShellHeight</code> stays numeric in
                <code>state.js</code>. A stray string forces the fallback height on each render.
              </li>
            </ul>
          </article>
        </div>
      </section>

      <section class="panel">
        <h2>Future-Ready Hooks</h2>
        <ul>
          <li>
            <strong>Designer sync</strong> - <code>phishingDesigner.js</code> should push template
            metadata + <code>signalIds</code> into <code>AppData.phishingSimulations</code> so new
            campaigns appear instantly in the sandbox inbox.
          </li>
          <li>
            <strong>Badge lab</strong> - <code>badgeExperiments.js</code> can listen for a custom
            event fired within <code>reportMessage</code> to showcase experimental badge unlocks.
          </li>
          <li>
            <strong>Analytics</strong> - hook into <code>recordSandboxSubmission</code> to emit a
            telemetry stub (`window.Analytics?.track`) without touching the feature DOM.
          </li>
        </ul>
      </section>
    </main>

    <footer>Updated November 2025 - WeldSecure Docs</footer>
  </body>
</html>
